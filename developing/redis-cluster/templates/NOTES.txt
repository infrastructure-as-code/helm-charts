{{- $port := .Values.shards.service.port }}
{{- $image := .Values.shards.image.repository }}
1. To forward the remote port locally:

  LOCAL_PORT=6379
  kubectl port-forward service/{{ include "redis-cluster.fullname" . }} --namespace {{ .Release.Namespace }} ${LOCAL_PORT}:{{ $port }}

  # run the Redis client from another terminal
  redis-cli -p ${LOCAL_PORT}

2. To connect to Redis without forwarding the remote port:

{{- if contains "ClusterIP" .Values.proxy.service.type }}
  kubectl run --namespace {{ .Release.Namespace }} --rm --tty -i --restart="Never" --image {{ $image }} --command -- redis-cli -h {{ include "redis-cluster.fullname" . }} -p {{ .Values.proxy.service.port }}

{{- else if contains "NodePort" .Values.proxy.service.type }}
  NODE_IP=$(kubectl get --namespace {{ .Release.Namespace }} -o jsonpath="{.spec.clusterIP}" services {{ include "redis-cluster.fullname" . }})
  NODE_PORT=$(kubectl get --namespace {{ .Release.Namespace }} -o jsonpath="{.spec.ports[0].port}" services {{ include "redis-cluster.fullname" . }})
  kubectl run --namespace {{ .Release.Namespace }} --rm --tty -i --restart="Never" --image {{ $image }} redis-client --command -- redis-cli -h ${NODE_IP} -p ${NODE_PORT}

{{- else if contains "LoadBalancer" .Values.proxy.service.type }}
     NOTE: It may take a few minutes for the LoadBalancer IP to be available.
           You can watch the status of by running 'kubectl get --namespace {{ .Release.Namespace }} svc -w {{ include "redis-cluster.fullname" . }}'

  SERVICE_IP=$(kubectl get svc --namespace {{ .Release.Namespace }} {{ include "redis-cluster.fullname" . }} --template "{{"{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}"}}")
  redis-cli -h ${SERVICE_IP} -p {{ .Values.proxy.service.port }}

{{- end }}
